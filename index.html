<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mural do Carnaval</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 0;
}

h1 {
    margin-bottom: 30px;
}

/* UPLOAD BONITO */

.upload-box {
    width: 280px;
    padding: 25px;
    border: 2px dashed #00ff88;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    transition: 0.3s;
    margin-bottom: 40px;
}

.upload-box:hover {
    background: rgba(0,255,136,0.1);
}

.upload-box input {
    display: none;
}

.upload-box p {
    margin: 0;
    font-weight: bold;
}

/* GRID */

.mural-grid {
    width: 90%;
    max-width: 1100px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
}

.mural-grid img {
    width: 100%;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
}

.mural-grid img:hover {
    transform: scale(1.03);
}

/* MODAL FULLSCREEN */

.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

.modal img {
    max-width: 90%;
    max-height: 80%;
    border-radius: 12px;
}

.modal.active {
    display: flex;
}

.close-btn {
    position: absolute;
    top: 25px;
    right: 35px;
    font-size: 30px;
    cursor: pointer;
}

.nav {
    position: absolute;
    top: 50%;
    font-size: 40px;
    cursor: pointer;
    user-select: none;
    transform: translateY(-50%);
}

.prev {
    left: 30px;
}

.next {
    right: 30px;
}
</style>
</head>

<body>

<h1>üé≠ Mural do Foli√£o</h1>

<label class="upload-box">
    <input type="file" id="photoFile" accept="image/*">
    <p>üì∏ Clique para enviar foto</p>
</label>

<div class="mural-grid" id="mural"></div>

<!-- MODAL -->
<div class="modal" id="modal">
    <span class="close-btn" onclick="closeModal()">‚úñ</span>
    <span class="nav prev" onclick="changeImage(-1)">‚ùÆ</span>
    <img id="modalImg">
    <span class="nav next" onclick="changeImage(1)">‚ùØ</span>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, 
  collection,
  addDoc,
  query,
  orderBy,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "SUA_API_KEY_AQUI",
  authDomain: "via-sacra-666d8.firebaseapp.com",
  projectId: "via-sacra-666d8",
  storageBucket: "via-sacra-666d8.firebasestorage.app",
  messagingSenderId: "401028486463",
  appId: "1:401028486463:web:dd300c0c25b26d4a78af8a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const muralRef = collection(db, "mural");
const muralContainer = document.getElementById("mural");

let images = [];
let currentIndex = 0;

/* LISTENER REALTIME */

const muralQuery = query(muralRef, orderBy("createdAt", "desc"));

onSnapshot(muralQuery, (snapshot) => {
    images = [];
    muralContainer.innerHTML = "";

    snapshot.forEach((doc) => {
        const data = doc.data();
        images.push(data.photoUrl);

        const img = document.createElement("img");
        img.src = data.photoUrl;
        img.onclick = () => openModal(images.indexOf(data.photoUrl));
        muralContainer.appendChild(img);
    });
});

/* UPLOAD */

document.getElementById("photoFile").addEventListener("change", addPhoto);

async function addPhoto(event) {
    const file = event.target.files[0];
    if (!file) return;

    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", "mural-caranval");

    const response = await fetch(
        "https://api.cloudinary.com/v1_1/deh1oslzj/image/upload",
        { method: "POST", body: formData }
    );

    const data = await response.json();

    await addDoc(muralRef, {
        photoUrl: data.secure_url,
        createdAt: new Date()
    });

    event.target.value = "";
}

/* MODAL */

const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

window.openModal = function(index) {
    currentIndex = index;
    modalImg.src = images[currentIndex];
    modal.classList.add("active");
};

window.closeModal = function() {
    modal.classList.remove("active");
};

window.changeImage = function(direction) {
    currentIndex += direction;

    if (currentIndex < 0) currentIndex = images.length - 1;
    if (currentIndex >= images.length) currentIndex = 0;

    modalImg.src = images[currentIndex];
};

/* TECLADO */

document.addEventListener("keydown", (e) => {
    if (!modal.classList.contains("active")) return;

    if (e.key === "ArrowRight") changeImage(1);
    if (e.key === "ArrowLeft") changeImage(-1);
    if (e.key === "Escape") closeModal();
});
</script>

</body>
</html>
